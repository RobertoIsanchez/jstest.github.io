<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Model Showcase</title>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(180deg, #0a0a0a 0%, #2a2a2a 50%, #4a4a4a 100%);
    }

    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      pointer-events: none;
    }

    /* Logo - Arriba Izquierda */
    .logo-container {
      position: absolute;
      top: 30px;
      left: 40px;
      display: flex;
      align-items: center;
      gap: 12px;
      pointer-events: auto;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .logo-text {
      color: #fff;
    }

    .logo-text h1 {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 2px;
    }

    .logo-text p {
      font-size: 10px;
      letter-spacing: 3px;
      opacity: 0.7;
      text-transform: uppercase;
    }

    /* Iconos Software - Arriba Derecha */
    .software-icons {
      position: absolute;
      top: 30px;
      right: 40px;
      display: flex;
      gap: 15px;
      pointer-events: auto;
    }

    .software-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: none;
    }

    .software-icon.visible {
      display: flex;
    }

    .software-icon:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    .software-icon svg {
      width: 20px;
      height: 20px;
      fill: #fff;
    }

    /* Info T칠cnica - Abajo Izquierda */
    .tech-info {
      position: absolute;
      bottom: 40px;
      left: 40px;
      color: #fff;
      max-width: 350px;
    }

    .model-number {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 5px;
      background: linear-gradient(90deg, #fff, #888);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .model-name {
      font-size: 14px;
      letter-spacing: 2px;
      text-transform: uppercase;
      opacity: 0.8;
      margin-bottom: 20px;
    }

    .tech-specs {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .spec-row {
      display: flex;
      gap: 20px;
      font-size: 11px;
      opacity: 0.6;
    }

    .spec-label {
      min-width: 80px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .spec-value {
      color: #aaa;
    }

    /* Controles de Animaci칩n */
    .animation-controls {
      margin-top: 25px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .anim-btn {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      pointer-events: auto;
    }

    .anim-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    .anim-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      transform: none;
    }

    .anim-btn svg {
      width: 16px;
      height: 16px;
      fill: #fff;
    }

    .anim-select {
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      color: #fff;
      font-size: 11px;
      letter-spacing: 1px;
      cursor: pointer;
      pointer-events: auto;
      min-width: 150px;
    }

    .anim-select:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.4);
    }

    .anim-select option {
      background: #1a1a1a;
      color: #fff;
    }

    .anim-status {
      font-size: 10px;
      letter-spacing: 1px;
      opacity: 0.5;
      text-transform: uppercase;
    }

    .no-animations {
      font-size: 10px;
      letter-spacing: 1px;
      opacity: 0.4;
      font-style: italic;
    }

    /* T칤tulo Central Decorativo */
    .background-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 180px;
      font-weight: 900;
      color: rgba(255, 255, 255, 0.03);
      letter-spacing: 20px;
      white-space: nowrap;
      z-index: 0;
      user-select: none;
    }

    /* Loading */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 14px;
      letter-spacing: 3px;
      text-transform: uppercase;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Controles */
    .controls-hint {
      position: absolute;
      bottom: 40px;
      right: 40px;
      color: rgba(255, 255, 255, 0.4);
      font-size: 11px;
      text-align: right;
      letter-spacing: 1px;
    }

    /* Controles de Iluminaci칩n HDR */
    .lighting-controls {
      position: absolute;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      pointer-events: auto;
    }

    .light-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .light-btn:hover {
      transform: scale(1.15);
      border-color: rgba(255, 255, 255, 0.6);
    }

    .light-btn.active {
      border-color: #fff;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
    }

    .light-btn::after {
      content: attr(data-name);
      position: absolute;
      right: 55px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 10px;
      letter-spacing: 1px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .light-btn:hover::after {
      opacity: 1;
    }

    /* Colores representativos de cada HDR */
    .light-btn[data-hdr="studio"] {
      background: linear-gradient(135deg, #3a3a3a 0%, #1a1a1a 100%);
    }

    .light-btn[data-hdr="sunset"] {
      background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
    }

    .light-btn[data-hdr="night"] {
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
    }

    .light-btn[data-hdr="forest"] {
      background: linear-gradient(135deg, #134e5e 0%, #71b280 100%);
    }

    .light-btn[data-hdr="city"] {
      background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
    }

    .light-btn[data-hdr="warehouse"] {
      background: linear-gradient(135deg, #8e9eab 0%, #eef2f3 100%);
    }

    /* Panel de ajustes sin fondo negro, solo transparente con backdrop-filter */
    .hdr-settings-panel {
      position: absolute;
      right: 100px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 20px;
      pointer-events: auto;
      min-width: 200px;
      backdrop-filter: blur(10px);
    }

    .hdr-settings-panel h3 {
      color: #fff;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 20px;
      opacity: 0.9;
    }

    /* A침adido estilo para el men칰 desplegable de texturas */
    .texture-view-select {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .texture-view-select:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .texture-view-select:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.2);
    }

    .texture-view-select option {
      background: #1a1a1a;
      color: #fff;
      padding: 10px;
    }

    .hdr-slider-group {
      margin-bottom: 18px;
    }

    .hdr-slider-group:last-child {
      margin-bottom: 0;
    }

    .hdr-slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .hdr-slider-label span {
      color: #fff;
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .hdr-slider-label .value {
      color: #fff;
      font-size: 10px;
      opacity: 0.9;
      font-family: monospace;
    }

    .hdr-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      outline: none;
      cursor: pointer;
    }

    .hdr-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .hdr-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    .hdr-slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    /* Toggle de sombras */
    .shadow-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.15);
    }

    .shadow-toggle span {
      color: #fff;
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .toggle-switch.active {
      background: rgba(100, 200, 100, 0.5);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }

    .toggle-switch.active::after {
      transform: translateX(20px);
    }

    /* Bot칩n reset */
    .hdr-reset-btn {
      width: 100%;
      margin-top: 15px;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .hdr-reset-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Panel de visualizaci칩n de materiales */
    /* Eliminado panel de visualizaci칩n de materiales */

    /* Galer칤a de modelos - Abajo Centro */
    .model-gallery {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      pointer-events: auto;
    }

    .gallery-item {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: all 0.3s ease;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .gallery-item:hover {
      transform: scale(1.1);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .gallery-item.active {
      border-color: #fff;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-item .gallery-number {
      font-size: 18px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.5);
    }

    .gallery-item::after {
      content: attr(data-name);
      position: absolute;
      bottom: calc(100% + 10px);
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 10px;
      letter-spacing: 1px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .gallery-item:hover::after {
      opacity: 1;
    }

    /* Flechas de navegaci칩n */
    .nav-arrow {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .nav-arrow:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.1);
    }

    .nav-arrow svg {
      width: 16px;
      height: 16px;
      fill: #fff;
    }
  </style>
</head>
<body>
  <div id="canvas-container">
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      Cargando modelo...
    </div>
  </div>

  <div class="background-text" id="background-text">MODEL</div>

  <div class="overlay">
    <!-- Logo - Arriba Izquierda -->
    <div class="logo-container">
      <div class="logo-icon">游꿛</div>
      <div class="logo-text">
        <h1>TU LOGO</h1>
        <p>3D Artist Portfolio</p>
      </div>
    </div>

    <!-- Iconos Software - Arriba Derecha -->
    <div class="software-icons" id="software-icons">
      <div class="software-icon" data-software="blender" title="Blender">
        <svg viewBox="0 0 60 60"><path d="M19.45,34.6c-.31,1.51,0,3.44.4,4.83.39,1.39.96,2.59,1.67,3.78.71,1.19,1.38,2.11,2.34,3.11s1.84,1.75,2.97,2.53c1.12.78,2.23,1.36,3.54,1.91,1.31.55,2.74.98,4.21,1.24,1.47.26,3.56.4,5.1.31,1.54-.1,3.22-.42,4.62-.84,1.4-.42,2.63-.93,3.86-1.59s2.2-1.36,3.25-2.24c1.05-.88,1.83-1.71,2.66-2.79.83-1.08,1.46-2.12,2.04-3.41.59-1.29,1-2.79,1.24-4.25s.21-3.6-.04-5.05c-.25-1.45-.71-2.87-1.3-4.15-.59-1.27-1.26-2.34-2.09-3.4-.83-1.06-1.68-1.91-2.7-2.75-1.03-.83-2.04-1.57-3.08-2.37-1.03-.8-2.07-1.59-3.1-2.39-1.03-.8-2.05-1.57-3.10-2.35-1.04-.79-2.01-1.61-3.08-2.37-1.07-.76-1.99-1.66-3.1-2.4-1.11-.73-1.92-1.84-3.28-2.17-1.35-.34-3.06-.06-3.93,1.27-.87,1.33.42,2.65,1.52,3.38s1.95,1.68,3.01,2.44c1.06.76,1.94,1.7,3,2.45-1.45.09-2.99.03-4.48.04s-3.04-.01-4.53,0-3.07-.01-4.53,0-3.08-.03-4.48,0-3.17-.1-4.44.09c-1.26.19-2.09.75-2.8,1.73-.71.98-.62,2.38.44,3.14,1.06.76,2.56.58,3.94.58s3.1,0,4.53,0,3.03-.04,4.44.04c-1.69,1.22-3.34,2.52-5,3.79-1.66,1.27-3.29,2.51-4.97,3.78-1.67,1.27-3.28,2.55-4.97,3.82-1.69,1.28-3.25,2.49-4.97,3.78-1.72,1.29-2.63,4.37-.55,5.8,2.08,1.43,4.52.02,6.11-1.43s3.23-2.58,4.84-3.96c1.6-1.38,3.19-2.6,4.8-3.95M38.96,22.87c1.92.19,4.08.65,5.72,1.67,1.63,1.02,2.76,2,3.81,3.62,1.05,1.62,1.68,3.87,1.53,5.82.14-1.95.83-3.9,2.02-5.41,1.19-1.51,2.33-2.51,4.04-3.34,1.71-.84,4.12-1.48,6.14-1.29Z"/><path d="M37.95,39.66h.92c3.29,0,6.95-2.85,6.95-6.33v-.75c0-2.17-1.39-3.98-3.16-5.19-1.78-1.21-4.71-1.51-6.74-.8-2.03.71-3.51,1.93-4.41,3.9-.91,1.97-.53,4.77.9,6.42,1.43,1.64,3.39,2.76,5.55,2.76Z"/></svg>
      </div>
      <div class="software-icon" data-software="substance" title="Substance Painter">
        <svg viewBox="0 0 60 60"><circle cx="26.93" cy="8.09" r="3.28"/><circle cx="50.99" cy="50.02" r="5.17"/><circle cx="6.12" cy="50.02" r="2.28"/><path d="M26.91,14.84c-11.06,0-20.01,8.95-20.01,20.01s8.95,20.01,20.01,20.01,20.01-8.95,20.01-20.01-8.95-20.01-20.01-20.01h0ZM13.36,27.08l13.52-7.81,13.48,7.81v7.06l-6.21-2v-1.46l-7.28-4.21-5.35,3.1,18.83,6.03v7.06l-13.52,7.81-13.52-7.78v-7.1l6.24,1.96v1.46l7.28,4.21,5.42-3.14-18.91-5.99v-7.03Z"/></svg>
      </div>
      <div class="software-icon" data-software="photoshop" title="Adobe Photoshop">
        <svg viewBox="0 0 60 60"><path d="M23.57,21.41c-1.01,0-1.7.1-2.06.2v6.51c.43.1,1.66.13,1.66.13,2.65,0,4.28-1.34,4.28-3.6,0-2.02-1.41-3.24-3.89-3.24Z"/><path d="M47.55,10H12.45c-1.35,0-2.45,1.09-2.45,2.44v35.1c0,1.35,1.1,2.45,2.45,2.45h35.1c1.35,0,2.45-1.1,2.45-2.45V12.45c0-1.35-1.1-2.45-2.45-2.45ZM30.37,29.75c-1.7,1.6-4.22,2.32-7.16,2.32-.66,0-1.24-.03-1.7-.1v7.88h-4.94v-21.74c1.54-.26,3.69-.46,6.74-.46s5.26.59,6.73,1.77c1.41,1.11,2.36,2.94,2.36,5.1s-.72,3.98-2.03,5.23ZM37.81,40.18c-2.1,0-3.96-.45-5.17-1.11l.88-3.56c.92.55,2.81,1.21,4.29,1.21s2.12-.52,2.12-1.34-.49-1.21-2.35-1.83c-3.3-1.11-4.58-2.91-4.55-4.81,0-2.97,2.55-5.23,6.51-5.23,1.86,0,3.53.43,4.51.92l-.88,3.43c-.72-.39-2.09-.91-3.47-.91-1.21,0-1.89.49-1.89,1.31,0,.75.62,1.14,2.58,1.83,3.04,1.04,4.32,2.58,4.35,4.93,0,2.98-2.36,5.17-6.93,5.17Z"/></svg>
      </div>
      <div class="software-icon" data-software="maya" title="Maya">
        <svg viewBox="0 0 24 24"><path d="M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.18l6.9 3.45L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      </div>
      <div class="software-icon" data-software="zbrush" title="ZBrush">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      </div>
      <div class="software-icon" data-software="cinema4d" title="Cinema 4D">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v12M6 12h12v12H6V12z"/></svg>
      </div>
      <div class="software-icon" data-software="3dsmax" title="3ds Max">
        <svg viewBox="0 0 24 24"><path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/><path d="M7 7h4v4H7V7zm6 0h4v4h-4V7zm-6 6h4v4H7V13zm6 0h4v4h-4v-4z"/></svg>
      </div>
      <div class="software-icon" data-software="marvelous" title="Marvelous Designer">
        <svg viewBox="0 0 24 24"><path d="M12 2l-2 7H4l6 4.5-2 7.5 6-4.5 6 4.5-2-7.5 6-4.5h-6L12 2z"/></svg>
      </div>
    </div>

    <!-- Info T칠cnica - Abajo Izquierda -->
    <div class="tech-info">
      <div class="model-number" id="model-number">#01</div>
      <div class="model-name" id="model-name">Nombre del Modelo*</div>
      
      <div class="tech-specs" id="tech-specs">
        <!-- Se genera din치micamente -->
      </div>

      <!-- Controles de Animaci칩n -->
      <div class="animation-controls" id="animation-controls">
        <span class="no-animations" id="no-anim-msg">Sin animaciones</span>
      </div>
    </div>

    <!-- Galer칤a de Modelos - Abajo Centro -->
    <div class="model-gallery" id="model-gallery">
      <button class="nav-arrow" id="prev-model" title="Anterior">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      </button>
      <!-- Los items de la galer칤a se generan din치micamente -->
      <div id="gallery-items" style="display: flex; gap: 15px;"></div>
      <button class="nav-arrow" id="next-model" title="Siguiente">
        <svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
      </button>
    </div>

    <!-- Controles de Iluminaci칩n HDR -->
    <div class="lighting-controls">
      <button class="light-btn active" data-hdr="studio" data-name="STUDIO" title="Studio"></button>
      <button class="light-btn" data-hdr="sunset" data-name="SUNSET" title="Sunset"></button>
      <button class="light-btn" data-hdr="night" data-name="NIGHT" title="Night"></button>
      <button class="light-btn" data-hdr="forest" data-name="FOREST" title="Forest"></button>
      <button class="light-btn" data-hdr="city" data-name="CITY" title="City"></button>
      <button class="light-btn" data-hdr="warehouse" data-name="WAREHOUSE" title="Warehouse"></button>
    </div>

    <!-- Panel de ajustes avanzados de HDR -->
    <div class="hdr-settings-panel">
      <h3>Ajustes de Luz</h3>
      
      <!-- Men칰 desplegable para selecci칩n de visualizaci칩n de texturas -->
      <select class="texture-view-select" id="texture-view-select">
        <option value="composite">Composite (Render)</option>
        <option value="wireframe">Wireframe</option>
        <option value="albedo">Albedo</option>
        <option value="metallic">Metallic</option>
        <option value="roughness">Roughness</option>
        <option value="normal">Normal</option>
        <option value="emissive">Emissive</option>
        <option value="opacity">Opacity</option>
      </select>

      <div class="hdr-slider-group">
        <div class="hdr-slider-label">
          <span>Rotaci칩n HDR</span>
          <span class="value" id="rotation-value">0춿</span>
        </div>
        <input type="range" class="hdr-slider" id="hdr-rotation" min="0" max="360" value="0" step="1">
      </div>

      <div class="hdr-slider-group">
        <div class="hdr-slider-label">
          <span>Exposici칩n</span>
          <span class="value" id="exposure-value">1.0</span>
        </div>
        <input type="range" class="hdr-slider" id="hdr-exposure" min="0.1" max="3" value="1" step="0.1">
      </div>

      <div class="hdr-slider-group">
        <div class="hdr-slider-label">
          <span>Intensidad Luz</span>
          <span class="value" id="intensity-value">1.0</span>
        </div>
        <input type="range" class="hdr-slider" id="light-intensity" min="0" max="3" value="1" step="0.1">
      </div>

      <div class="hdr-slider-group">
        <div class="hdr-slider-label">
          <span>Intensidad Ambiente</span>
          <span class="value" id="ambient-value">0.5</span>
        </div>
        <input type="range" class="hdr-slider" id="ambient-intensity" min="0" max="2" value="0.5" step="0.1">
      </div>

      <div class="shadow-toggle">
        <span>Sombras</span>
        <div class="toggle-switch active" id="shadow-toggle"></div>
      </div>

      <div class="hdr-slider-group" id="shadow-settings" style="margin-top: 15px;">
        <div class="hdr-slider-label">
          <span>Suavidad Sombra</span>
          <span class="value" id="shadow-blur-value">2</span>
        </div>
        <input type="range" class="hdr-slider" id="shadow-blur" min="0" max="10" value="2" step="1">
      </div>

      <button class="hdr-reset-btn" id="hdr-reset">Restablecer</button>
    </div>

    <!-- Controles -->
    <div class="controls-hint">
      Arrastra para rotar<br>
      Scroll para zoom
    </div>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';


    const modelsGallery = [
      {
        id: 1,
        name: "Owl",
        path: "/owl.glb",
        thumbnail: "",
        backgroundText: "OWL",
        software: ["blender", "substance"],
        specs: {
          "Pol칤gonos": "12,000 tris",
          "Texturas": "2K PBR",
          "Software": "Blender, Substance Painter",
          "Tiempo": "~8 horas",
          "A침o": "2024"
        }
      },
      {
        id: 2,
        name: "Character Model",
        path: "/models/character.glb",
        thumbnail: "",
        backgroundText: "CHARACTER",
        software: ["blender", "zbrush", "substance", "photoshop"],
        specs: {
          "Pol칤gonos": "85,000 tris",
          "Texturas": "4K PBR",
          "Software": "Blender, ZBrush, Substance",
          "Rigging": "S칤, completo",
          "Tiempo": "~120 horas"
        }
      },
      {
        id: 3,
        name: "Environment Prop",
        path: "/models/prop.glb",
        thumbnail: "",
        backgroundText: "PROP",
        software: ["blender", "photoshop"],
        specs: {
          "Pol칤gonos": "5,200 tris",
          "Texturas": "2K Diffuse",
          "Software": "Blender, Photoshop",
          "LODs": "3 niveles",
          "Tiempo": "~15 horas"
        }
      },
      {
        id: 4,
        name: "Vehicle",
        path: "/models/vehicle.glb",
        thumbnail: "",
        backgroundText: "VEHICLE",
        software: ["blender", "substance", "maya"],
        specs: {
          "Pol칤gonos": "45,000 tris",
          "Texturas": "4K PBR",
          "Software": "Blender, Maya, Substance",
          "Interior": "Detallado",
          "Tiempo": "~80 horas"
        }
      }
    ];

    // Variables globales
    let currentModelIndex = 0;
    let currentModel = null;
    let mixer = null;
    let animations = [];
    let currentAction = null;
    let isPlaying = true;
    const clock = new THREE.Clock();

    let originalMaterials = new Map();
    let currentViewMode = 'composite';

    // Setup
    const container = document.getElementById('canvas-container');
    const loading = document.getElementById('loading');
    const animControls = document.getElementById('animation-controls');
    const galleryItems = document.getElementById('gallery-items');
    const backgroundText = document.getElementById('background-text');

    // Scene
    const scene = new THREE.Scene();

    // Camera
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1, 5);

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1;
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    container.appendChild(renderer.domElement);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 2;
    controls.maxDistance = 10;
    controls.target.set(0, 0.5, 0);

    // HDR paths
    const hdrPaths = {
      studio: '/hdri/studio.hdr',
      sunset: '/hdri/sunset.hdr',
      night: '/hdri/night.hdr',
      forest: '/hdri/forest.hdr',
      city: '/hdri/city.hdr',
      warehouse: '/hdri/warehouse.hdr'
    };

    const hdrCache = {};
    const rgbeLoader = new RGBELoader();

    // Luces por defecto
    const defaultLights = [];

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    defaultLights.push(ambientLight);

    const mainLight = new THREE.DirectionalLight(0xffffff, 1.5);
    mainLight.position.set(5, 10, 7);
    mainLight.castShadow = true;
    mainLight.shadow.mapSize.width = 2048;
    mainLight.shadow.mapSize.height = 2048;
    mainLight.shadow.camera.near = 0.1;
    mainLight.shadow.camera.far = 50;
    mainLight.shadow.camera.left = -10;
    mainLight.shadow.camera.right = 10;
    mainLight.shadow.camera.top = 10;
    mainLight.shadow.camera.bottom = -10;
    mainLight.shadow.radius = 2;
    mainLight.shadow.bias = -0.0001;
    scene.add(mainLight);
    defaultLights.push(mainLight);

    const fillLight = new THREE.DirectionalLight(0x8888ff, 0.5);
    fillLight.position.set(-5, 5, -5);
    scene.add(fillLight);
    defaultLights.push(fillLight);

    const rimLight = new THREE.DirectionalLight(0xffffff, 0.8);
    rimLight.position.set(0, 5, -10);
    scene.add(rimLight);
    defaultLights.push(rimLight);

    function setViewMode(mode) {
      if (!currentModel) return;
      
      currentViewMode = mode;
      
      currentModel.traverse((child) => {
        if (child.isMesh) {
          // Guardar el material original si no est치 guardado
          if (!originalMaterials.has(child.uuid)) {
            originalMaterials.set(child.uuid, child.material.clone());
          }
          
          const originalMat = originalMaterials.get(child.uuid);
          
          switch(mode) {
            case 'composite':
              // Restaurar material original
              child.material = originalMat.clone();
              child.material.wireframe = false;
              break;
              
            case 'albedo':
              // Mostrar solo albedo/color base
              const albedoMat = new THREE.MeshBasicMaterial({
                map: originalMat.map,
                color: originalMat.color
              });
              child.material = albedoMat;
              break;
              
            case 'metallic':
              // Visualizar metalness
              const metallicMat = new THREE.MeshBasicMaterial({
                map: originalMat.metalnessMap,
                color: originalMat.metalnessMap ? 0xffffff : new THREE.Color(originalMat.metalness, originalMat.metalness, originalMat.metalness)
              });
              child.material = metallicMat;
              break;
              
            case 'roughness':
              // Visualizar roughness
              const roughnessMat = new THREE.MeshBasicMaterial({
                map: originalMat.roughnessMap,
                color: originalMat.roughnessMap ? 0xffffff : new THREE.Color(originalMat.roughness, originalMat.roughness, originalMat.roughness)
              });
              child.material = roughnessMat;
              break;
              
            case 'emissive':
              // Visualizar emissive
              const emissiveMat = new THREE.MeshBasicMaterial({
                map: originalMat.emissiveMap,
                color: originalMat.emissive,
                emissive: originalMat.emissive,
                emissiveIntensity: 1
              });
              child.material = emissiveMat;
              break;
              
            case 'normal':
              // Visualizar normal map
              if (originalMat.normalMap) {
                const normalMat = new THREE.MeshBasicMaterial({
                  map: originalMat.normalMap
                });
                child.material = normalMat;
              } else {
                const noNormalMat = new THREE.MeshBasicMaterial({
                  color: 0x8080ff
                });
                child.material = noNormalMat;
              }
              break;
              
            case 'opacity':
              // Visualizar alpha/opacity
              const opacityMat = new THREE.MeshBasicMaterial({
                map: originalMat.alphaMap,
                color: 0xffffff,
                transparent: true,
                opacity: originalMat.opacity
              });
              child.material = opacityMat;
              break;
              
            case 'wireframe':
              // Modo wireframe
              const wireframeMat = originalMat.clone();
              wireframeMat.wireframe = true;
              wireframeMat.color = new THREE.Color(0x00ffff);
              child.material = wireframeMat;
              break;
          }
          
          child.material.needsUpdate = true;
        }
      });
    }

    const textureViewSelect = document.getElementById('texture-view-select');
    textureViewSelect.addEventListener('change', (e) => {
      const mode = e.target.value;
      setViewMode(mode);
    });


    function createGalleryUI() {
      galleryItems.innerHTML = '';
      
      modelsGallery.forEach((model, index) => {
        const item = document.createElement('div');
        item.className = `gallery-item ${index === currentModelIndex ? 'active' : ''}`;
        item.dataset.index = index;
        item.dataset.name = model.name;
        
        if (model.thumbnail) {
          item.innerHTML = `<img src="${model.thumbnail}" alt="${model.name}">`;
        } else {
          item.innerHTML = `<span class="gallery-number">${String(index + 1).padStart(2, '0')}</span>`;
        }
        
        item.addEventListener('click', () => loadModelByIndex(index));
        galleryItems.appendChild(item);
      });
    }

    function updateSoftwareIcons(softwareList) {
      const allIcons = document.querySelectorAll('.software-icon');
      allIcons.forEach(icon => {
        const software = icon.dataset.software;
        if (softwareList.includes(software)) {
          icon.classList.add('visible');
        } else {
          icon.classList.remove('visible');
        }
      });
    }

    function updateTechSpecs(specs) {
      const techSpecs = document.getElementById('tech-specs');
      techSpecs.innerHTML = '';
      
      Object.entries(specs).forEach(([label, value]) => {
        const row = document.createElement('div');
        row.className = 'spec-row';
        row.innerHTML = `
          <span class="spec-label">${label}</span>
          <span class="spec-value">${value}</span>
        `;
        techSpecs.appendChild(row);
      });
    }

    function updateModelInfo(modelData) {
      document.getElementById('model-number').textContent = `#${String(modelData.id).padStart(2, '0')}`;
      document.getElementById('model-name').textContent = modelData.name + '*';
      backgroundText.textContent = modelData.backgroundText || 'MODEL';
      
      updateTechSpecs(modelData.specs);
      updateSoftwareIcons(modelData.software);
      
      document.querySelectorAll('.gallery-item').forEach((item, index) => {
        item.classList.toggle('active', index === currentModelIndex);
      });
    }

    function loadModelByIndex(index) {
      if (index < 0 || index >= modelsGallery.length) return;
      currentModelIndex = index;
      
      const modelData = modelsGallery[index];
      updateModelInfo(modelData);
      loadModel(modelData.path);
    }

    document.getElementById('prev-model').addEventListener('click', () => {
      const newIndex = (currentModelIndex - 1 + modelsGallery.length) % modelsGallery.length;
      loadModelByIndex(newIndex);
    });

    document.getElementById('next-model').addEventListener('click', () => {
      const newIndex = (currentModelIndex + 1) % modelsGallery.length;
      loadModelByIndex(newIndex);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        const newIndex = (currentModelIndex - 1 + modelsGallery.length) % modelsGallery.length;
        loadModelByIndex(newIndex);
      } else if (e.key === 'ArrowRight') {
        const newIndex = (currentModelIndex + 1) % modelsGallery.length;
        loadModelByIndex(newIndex);
      }
    });


    function createAnimationControls(clips) {
      animControls.innerHTML = '';
      
      if (clips.length === 0) {
        animControls.innerHTML = '<span class="no-animations">Sin animaciones</span>';
        return;
      }

      const playBtn = document.createElement('button');
      playBtn.className = 'anim-btn';
      playBtn.id = 'play-btn';
      playBtn.title = 'Reproducir/Pausar';
      playBtn.innerHTML = `
        <svg viewBox="0 0 24 24" id="play-icon">
          <path d="M6 4l12 8-12 8V4z"/>
        </svg>
        <svg viewBox="0 0 24 24" id="pause-icon" style="display:none;">
          <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
        </svg>
      `;
      
      const stopBtn = document.createElement('button');
      stopBtn.className = 'anim-btn';
      stopBtn.title = 'Detener';
      stopBtn.innerHTML = `<svg viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"/></svg>`;

      const select = document.createElement('select');
      select.className = 'anim-select';
      select.id = 'anim-select';
      
      clips.forEach((clip, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = clip.name || `Animaci칩n ${index + 1}`;
        select.appendChild(option);
      });

      const status = document.createElement('span');
      status.className = 'anim-status';
      status.id = 'anim-status';
      status.textContent = 'Reproduciendo';

      animControls.appendChild(playBtn);
      animControls.appendChild(stopBtn);
      animControls.appendChild(select);
      animControls.appendChild(status);

      playBtn.addEventListener('click', togglePlay);
      stopBtn.addEventListener('click', stopAnimation);
      select.addEventListener('change', (e) => playAnimation(parseInt(e.target.value)));

      playAnimation(0);
      updatePlayButton();
    }

    function playAnimation(index) {
      if (!mixer || !animations[index]) return;

      if (currentAction) {
        currentAction.fadeOut(0.3);
      }

      currentAction = mixer.clipAction(animations[index]);
      currentAction.reset();
      currentAction.fadeIn(0.3);
      currentAction.play();
      
      isPlaying = true;
      updatePlayButton();
      updateStatus('Reproduciendo');
    }

    function togglePlay() {
      if (!currentAction) return;

      if (isPlaying) {
        currentAction.paused = true;
        isPlaying = false;
        updateStatus('Pausado');
      } else {
        currentAction.paused = false;
        isPlaying = true;
        updateStatus('Reproduciendo');
      }
      updatePlayButton();
    }

    function stopAnimation() {
      if (!currentAction) return;

      currentAction.stop();
      currentAction.reset();
      isPlaying = false;
      updatePlayButton();
      updateStatus('Detenido');
    }

    function updatePlayButton() {
      const playIcon = document.getElementById('play-icon');
      const pauseIcon = document.getElementById('pause-icon');
      if (playIcon && pauseIcon) {
        playIcon.style.display = isPlaying ? 'none' : 'block';
        pauseIcon.style.display = isPlaying ? 'block' : 'none';
      }
    }

    function updateStatus(text) {
      const status = document.getElementById('anim-status');
      if (status) status.textContent = text;
    }


    function loadHDR(hdrName) {
      const path = hdrPaths[hdrName];
      
      if (hdrCache[hdrName]) {
        applyEnvironment(hdrCache[hdrName]);
        return;
      }

      rgbeLoader.load(path, 
        (texture) => {
          texture.mapping = THREE.EquirectangularReflectionMapping;
          hdrCache[hdrName] = texture;
          applyEnvironment(texture);
        },
        undefined,
        (error) => {
          console.error('Error cargando HDR:', error);
          // Fallback to simulated lighting if HDR fails to load
          applySimulatedLighting(hdrName);
        }
      );
    }

    function applyEnvironment(texture) {
      scene.environment = texture;
      scene.background = null; // Clear previous background if any
    }

    // Function to apply simulated lighting as a fallback
    function applySimulatedLighting(hdrName) {
      defaultLights.forEach(light => {
        light.intensity = 0; // Turn off existing lights initially
      });
      scene.environment = null; // Ensure no HDR environment is active

      const lightConfigs = {
        studio: {
          ambient: { color: 0xffffff, intensity: 0.6 },
          main: { color: 0xffffff, intensity: 1.5, pos: [5, 10, 7] },
          fill: { color: 0xcccccc, intensity: 0.4, pos: [-5, 5, -5] },
          rim: { color: 0xffffff, intensity: 0.8, pos: [0, 5, -10] }
        },
        sunset: {
          ambient: { color: 0xffa07a, intensity: 0.4 },
          main: { color: 0xff8c00, intensity: 2.0, pos: [-8, 3, 5] },
          fill: { color: 0xff6347, intensity: 0.6, pos: [5, 2, -5] },
          rim: { color: 0xffd700, intensity: 1.0, pos: [0, 8, -8] }
        },
        night: {
          ambient: { color: 0x1a1a2e, intensity: 0.3 },
          main: { color: 0x4a69bd, intensity: 1.0, pos: [5, 10, 7] },
          fill: { color: 0x6c5ce7, intensity: 0.5, pos: [-5, 5, -5] },
          rim: { color: 0x00cec9, intensity: 0.6, pos: [0, 5, -10] }
        },
        forest: {
          ambient: { color: 0x2d5016, intensity: 0.5 },
          main: { color: 0x90EE90, intensity: 1.2, pos: [3, 12, 5] },
          fill: { color: 0x228B22, intensity: 0.4, pos: [-5, 5, -5] },
          rim: { color: 0xADFF2F, intensity: 0.7, pos: [0, 5, -10] }
        },
        city: {
          ambient: { color: 0x2c3e50, intensity: 0.4 },
          main: { color: 0x3498db, intensity: 1.3, pos: [5, 10, 7] },
          fill: { color: 0x9b59b6, intensity: 0.5, pos: [-5, 5, -5] },
          rim: { color: 0xe74c3c, intensity: 0.6, pos: [0, 5, -10] }
        },
        warehouse: {
          ambient: { color: 0xffffff, intensity: 0.8 },
          main: { color: 0xffffff, intensity: 1.8, pos: [0, 15, 0] },
          fill: { color: 0xeeeeee, intensity: 0.6, pos: [-5, 5, -5] },
          rim: { color: 0xffffff, intensity: 0.4, pos: [0, 5, -10] }
        }
      };

      const config = lightConfigs[hdrName] || lightConfigs.studio; // Default to studio if name not found

      ambientLight.color.setHex(config.ambient.color);
      ambientLight.intensity = config.ambient.intensity;

      mainLight.color.setHex(config.main.color);
      mainLight.intensity = config.main.intensity;
      mainLight.position.set(...config.main.pos);

      fillLight.color.setHex(config.fill.color);
      fillLight.intensity = config.fill.intensity;
      fillLight.position.set(...config.fill.pos);

      rimLight.color.setHex(config.rim.color);
      rimLight.intensity = config.rim.intensity;
      rimLight.position.set(...config.rim.pos);
    }

    const lightButtons = document.querySelectorAll('.light-btn');
    lightButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        lightButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const hdrName = btn.dataset.hdr;
        loadHDR(hdrName);
      });
    });

    loadHDR('studio'); // Load studio HDR by default

    const hdrRotationSlider = document.getElementById('hdr-rotation');
    const rotationValue = document.getElementById('rotation-value');
    
    hdrRotationSlider.addEventListener('input', (e) => {
      const rotation = parseFloat(e.target.value);
      rotationValue.textContent = `${rotation}춿`;
      
      if (scene.environment) {
        scene.environment.rotation = rotation * (Math.PI / 180);
      }
      // Adjust light positions to match HDR rotation if HDR is active
      if (scene.environment) {
        const radians = THREE.MathUtils.degToRad(rotation);
        // Example: rotate directional lights to follow the environment
        mainLight.position.set(
          5 * Math.cos(radians) - 7 * Math.sin(radians),
          10,
          5 * Math.sin(radians) + 7 * Math.cos(radians)
        );
        fillLight.position.set(
          -5 * Math.cos(radians) + 5 * Math.sin(radians),
          5,
          -5 * Math.sin(radians) - 5 * Math.cos(radians)
        );
        rimLight.position.set(
          -10 * Math.sin(radians),
          5,
          -10 * Math.cos(radians)
        );
      }
    });

    const exposureSlider = document.getElementById('hdr-exposure');
    const exposureValue = document.getElementById('exposure-value');
    
    exposureSlider.addEventListener('input', (e) => {
      const exposure = parseFloat(e.target.value);
      exposureValue.textContent = exposure.toFixed(1);
      renderer.toneMappingExposure = exposure;
    });

    const lightIntensitySlider = document.getElementById('light-intensity');
    const intensityValue = document.getElementById('intensity-value');
    
    lightIntensitySlider.addEventListener('input', (e) => {
      const intensity = parseFloat(e.target.value);
      intensityValue.textContent = intensity.toFixed(1);
      
      // Apply intensity to non-ambient lights
      if (defaultLights[1]) defaultLights[1].intensity = intensity * 1.5; // Main light multiplier
      if (defaultLights[2]) defaultLights[2].intensity = intensity * 0.5; // Fill light multiplier
      if (defaultLights[3]) defaultLights[3].intensity = intensity * 0.8; // Rim light multiplier
    });

    const ambientIntensitySlider = document.getElementById('ambient-intensity');
    const ambientValue = document.getElementById('ambient-value');
    
    ambientIntensitySlider.addEventListener('input', (e) => {
      const intensity = parseFloat(e.target.value);
      ambientValue.textContent = intensity.toFixed(1);
      
      if (defaultLights[0]) {
        defaultLights[0].intensity = intensity;
      }
    });

    const shadowToggle = document.getElementById('shadow-toggle');
    const shadowSettings = document.getElementById('shadow-settings');
    
    shadowToggle.addEventListener('click', () => {
      shadowToggle.classList.toggle('active');
      const isActive = shadowToggle.classList.contains('active');
      
      renderer.shadowMap.enabled = isActive;
      
      // Apply shadow casting to lights and meshes
      defaultLights.forEach(light => {
        if (light.castShadow !== undefined) {
          light.castShadow = isActive;
        }
      });
      
      if (currentModel) {
        currentModel.traverse((child) => {
          if (child.isMesh) {
            child.castShadow = isActive;
            child.receiveShadow = isActive;
          }
        });
      }
      
      shadowSettings.style.display = isActive ? 'block' : 'none';
    });

    const shadowBlurSlider = document.getElementById('shadow-blur');
    const shadowBlurValue = document.getElementById('shadow-blur-value');
    
    shadowBlurSlider.addEventListener('input', (e) => {
      const blur = parseInt(e.target.value);
      shadowBlurValue.textContent = blur;
      
      // Apply blur to the main light's shadow
      if (defaultLights[1] && defaultLights[1].shadow) {
        defaultLights[1].shadow.radius = blur;
      }
    });

    const hdrResetBtn = document.getElementById('hdr-reset');
    hdrResetBtn.addEventListener('click', () => {
      // Reset sliders and values
      hdrRotationSlider.value = 0;
      rotationValue.textContent = '0춿';
      
      exposureSlider.value = 1;
      exposureValue.textContent = '1.0';
      
      lightIntensitySlider.value = 1;
      intensityValue.textContent = '1.0';
      
      ambientIntensitySlider.value = 0.5;
      ambientValue.textContent = '0.5';
      
      shadowBlurSlider.value = 2;
      shadowBlurValue.textContent = '2';
      
      // Reset scene properties
      if (scene.environment) scene.environment.rotation = 0;
      renderer.toneMappingExposure = 1;
      
      ambientLight.intensity = 0.5;
      mainLight.intensity = 1.5;
      fillLight.intensity = 0.5;
      rimLight.intensity = 0.8;
      
      // Reset light positions to default
      mainLight.position.set(5, 10, 7);
      fillLight.position.set(-5, 5, -5);
      rimLight.position.set(0, 5, -10);
      
      // Reset shadow properties
      if (defaultLights[1] && defaultLights[1].shadow) defaultLights[1].shadow.radius = 2;
      
      // Ensure shadows are enabled and visible
      shadowToggle.classList.add('active');
      renderer.shadowMap.enabled = true;
      shadowSettings.style.display = 'block';

      // Re-apply the active HDR or simulated lighting
      const activeLightBtn = document.querySelector('.light-btn.active');
      if (activeLightBtn) {
        loadHDR(activeLightBtn.dataset.hdr);
      } else {
        loadHDR('studio'); // Default to studio if no button is active
      }
    });


    function loadModel(path) {
      if (currentModel) {
        scene.remove(currentModel);
        currentModel = null;
      }
      
      originalMaterials.clear(); // Clear materials for the new model
      
      if (mixer) {
        mixer.stopAllAction();
        mixer = null;
      }
      
      animations = [];
      currentAction = null;
      isPlaying = true;

      loading.style.display = 'block';
      loading.innerHTML = `<div class="loading-spinner"></div>Cargando modelo...`;

      const loader = new GLTFLoader();
      loader.load(
        path,
        (gltf) => {
          currentModel = gltf.scene;
          
          // Center and scale the model
          const box = new THREE.Box3().setFromObject(currentModel);
          const center = box.getCenter(new THREE.Vector3());
          const size = box.getSize(new THREE.Vector3());
          
          // Position the model at the origin and scale it down
          currentModel.position.sub(center);
          
          const maxDim = Math.max(size.x, size.y, size.z);
          const scale = 2 / maxDim; // Scale to fit within a 2-unit bounding box
          currentModel.scale.multiplyScalar(scale);
          
          // Adjust position slightly to center it vertically
          currentModel.position.y += (size.y / 2) * scale; 

          currentModel.traverse((child) => {
            if (child.isMesh) {
              // Enable shadows for the loaded model
              child.castShadow = renderer.shadowMap.enabled;
              child.receiveShadow = renderer.shadowMap.enabled;
              
              // Store original materials for view mode switching
              if (!originalMaterials.has(child.uuid)) {
                originalMaterials.set(child.uuid, child.material.clone());
              }
            }
          });
          
          scene.add(currentModel);
          
          // Handle animations
          if (gltf.animations && gltf.animations.length > 0) {
            mixer = new THREE.AnimationMixer(currentModel);
            animations = gltf.animations;
            createAnimationControls(animations);
          } else {
            createAnimationControls([]); // Show "no animations" message
          }
          
          // Apply the current view mode to the newly loaded model
          setViewMode(currentViewMode);
          
          loading.style.display = 'none'; // Hide loading indicator

          // Reset camera and controls target
          camera.position.set(0, 1, 5); // A sensible default position
          controls.target.set(0, 0.5, 0); // Target a point slightly above the model's base
          controls.update();
        },
        (xhr) => {
          // Update loading progress
          const percent = (xhr.loaded / xhr.total) * 100;
          loading.innerHTML = `<div class="loading-spinner"></div>Cargando... ${percent.toFixed(0)}%`;
        },
        (error) => {
          // Handle loading errors
          console.error('Error cargando el modelo:', error);
          loading.innerHTML = `Error al cargar el modelo<br><small>Verifica la ruta: ${path}</small>`;
        }
      );
    }


    function animate() {
      requestAnimationFrame(animate);
      
      const delta = clock.getDelta();
      
      // Update animation mixer if it exists
      if (mixer) {
        mixer.update(delta);
      }
      
      // Update orbit controls
      controls.update();
      
      // Render the scene
      renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Initial setup
    createGalleryUI();
    loadModelByIndex(0); // Load the first model in the gallery
    animate(); // Start the animation loop
  </script>
</body>
</html>
