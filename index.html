<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Model Showcase</title>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Segoe UI', sans-serif;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #0a0a0a;
    }

    #canvas-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      pointer-events: none;
      padding: 24px 32px;
    }

    /* ============================================
       PANEL DE ILUMINACIÓN - ARRIBA IZQUIERDA
    ============================================ */
    .lighting-panel {
      position: absolute;
      top: 24px;
      left: 32px;
      pointer-events: auto;
      color: #fff;
    }

    .lighting-header {
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 12px;
      opacity: 0.7;
    }

    .light-type-selector {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .light-nav-btn {
      width: 28px;
      height: 28px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .light-nav-btn:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.4);
    }

    .light-nav-btn svg {
      width: 14px;
      height: 14px;
      fill: currentColor;
    }

    .light-icon-container {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      transition: all 0.3s;
    }

    .light-icon-container svg {
      width: 28px;
      height: 28px;
      fill: #fff;
      opacity: 0.9;
    }

    .light-type-name {
      font-size: 11px;
      letter-spacing: 3px;
      text-transform: uppercase;
      margin-bottom: 20px;
      opacity: 0.6;
      text-align: center;
      width: 130px;
    }

    .slider-group {
      margin-bottom: 14px;
    }

    .slider-label {
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      opacity: 0.5;
      margin-bottom: 6px;
      display: block;
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .slider {
      -webkit-appearance: none;
      appearance: none;
      width: 100px;
      height: 3px;
      background: rgba(255,255,255,0.15);
      border-radius: 2px;
      outline: none;
      cursor: pointer;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 10px;
      height: 10px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 10px;
      height: 10px;
      background: #fff;
      border-radius: 50%;
      border: none;
      cursor: pointer;
    }

    .shadow-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 16px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .shadow-label {
      font-size: 9px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      opacity: 0.5;
    }

    .toggle-switch {
      position: relative;
      width: 36px;
      height: 18px;
      background: rgba(255,255,255,0.1);
      border-radius: 9px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: rgba(255,255,255,0.3);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 14px;
      height: 14px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch.active::after {
      transform: translateX(18px);
    }

    /* ============================================
       CONTROLES DE ANIMACIÓN - ARRIBA CENTRO
    ============================================ */
    .animation-panel {
      position: absolute;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 12px;
      pointer-events: auto;
    }

    .anim-btn {
      width: 36px;
      height: 36px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      color: #fff;
    }

    .anim-btn:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.4);
    }

    .anim-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .anim-btn svg {
      width: 14px;
      height: 14px;
      fill: currentColor;
    }

    .anim-select {
      padding: 8px 32px 8px 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
      min-width: 140px;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
    }

    .anim-select:focus {
      outline: none;
      border-color: rgba(255,255,255,0.4);
    }

    .anim-select option {
      background: #1a1a1a;
      color: #fff;
    }

    .fps-display {
      font-size: 12px;
      color: rgba(255,255,255,0.5);
      font-family: monospace;
      min-width: 60px;
    }

    .fps-display span {
      color: #fff;
    }

    /* ============================================
       DROPDOWN DE RENDER MODE - ARRIBA DERECHA
    ============================================ */
    .render-dropdown-container {
      position: absolute;
      top: 24px;
      right: 32px;
      pointer-events: auto;
    }

    .render-dropdown-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 16px;
      min-width: 160px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .render-dropdown-btn:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.3);
    }

    .render-dropdown-btn svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
      transition: transform 0.2s;
    }

    .render-dropdown-btn.open svg {
      transform: rotate(180deg);
    }

    .render-dropdown-menu {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      min-width: 160px;
      background: rgba(20,20,20,0.95);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      padding: 6px 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s;
      backdrop-filter: blur(10px);
    }

    .render-dropdown-menu.open {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .render-option {
      display: block;
      width: 100%;
      padding: 10px 16px;
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.7);
      font-size: 13px;
      text-align: left;
      cursor: pointer;
      transition: all 0.15s;
    }

    .render-option:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }

    .render-option.active {
      color: #fff;
      background: rgba(255,255,255,0.08);
    }

    /* ============================================
       INFO DEL MODELO - ABAJO IZQUIERDA
    ============================================ */
    .model-info {
      position: absolute;
      bottom: 24px;
      left: 32px;
      color: #fff;
      pointer-events: auto;
    }

    .tech-specs {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 8px;
    }

    .spec-row {
      display: flex;
      gap: 8px;
      font-size: 9px;
      opacity: 0.5;
    }

    .spec-label {
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .spec-value {
      opacity: 0.8;
    }

    .model-name {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
      margin-bottom: 12px;
      text-transform: uppercase;
    }

    .software-icons {
      display: flex;
      gap: 10px;
    }

    .software-icon {
      width: 24px;
      height: 24px;
      opacity: 0.5;
      transition: opacity 0.2s;
      display: none;
    }

    .software-icon.visible {
      display: block;
    }

    .software-icon:hover {
      opacity: 1;
    }

    .software-icon svg {
      width: 100%;
      height: 100%;
      fill: #fff;
    }

    /* ============================================
       GALERÍA DE MODELOS - ABAJO CENTRO
    ============================================ */
    .model-gallery {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 12px;
      pointer-events: auto;
    }

    .gallery-nav {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.2);
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      transition: all 0.2s;
    }

    .gallery-nav:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.4);
    }

    .gallery-nav svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    .gallery-items {
      display: flex;
      gap: 10px;
    }

    .gallery-item {
      width: 56px;
      height: 56px;
      border-radius: 10px;
      border: 2px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.03);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      overflow: hidden;
    }

    .gallery-item:hover {
      border-color: rgba(255,255,255,0.4);
      transform: scale(1.05);
    }

    .gallery-item.active {
      border-color: #fff;
      background: rgba(255,255,255,0.1);
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-number {
      font-size: 16px;
      font-weight: 700;
      color: rgba(255,255,255,0.4);
    }

    .gallery-item.active .gallery-number {
      color: #fff;
    }

    /* ============================================
       HINTS DE CONTROLES - ABAJO DERECHA
    ============================================ */
    .controls-hint {
      position: absolute;
      bottom: 24px;
      right: 32px;
      text-align: right;
      color: rgba(255,255,255,0.35);
      font-size: 11px;
      line-height: 1.6;
    }

    /* ============================================
       LOADING
    ============================================ */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-align: center;
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 2px solid rgba(255,255,255,0.1);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .no-animations {
      font-size: 11px;
      opacity: 0.4;
      font-style: italic;
    }

    /* Hide mobile panel on desktop */
    .mobile-sliders-panel {
      display: none;
    }

    /* ============================================
       RESPONSIVE MOBILE STYLES
    ============================================ */
    @media (max-width: 768px) {
      .overlay {
        padding: 16px;
      }

      /* Model info - Top left on mobile with reordered elements */
      .model-info {
        position: absolute;
        top: 16px;
        left: 16px;
        bottom: auto;
        display: flex;
        flex-direction: column;
      }

      .model-name {
        font-size: 20px;
        margin-bottom: 6px;
        order: 1; /* Nombre primero */
      }

      .software-icons {
        margin-bottom: 10px;
        order: 2; /* Íconos segundo */
      }

      .tech-specs {
        margin-bottom: 0;
        order: 3; /* Specs al final (debajo del nombre e íconos) */
      }

      /* Controls hint - Below model info on mobile */
      .controls-hint {
        position: absolute;
        top: 150px;
        left: 16px;
        right: auto;
        bottom: auto;
        text-align: left;
        font-size: 10px;
      }

      /* Render dropdown and Light Type - Top right stacked */
      .render-dropdown-container {
        top: 16px;
        right: 16px;
      }

      .render-dropdown-btn {
        min-width: 120px;
        padding: 8px 12px;
        font-size: 12px;
      }

      .render-dropdown-menu {
        min-width: 120px;
      }

      .render-option {
        padding: 8px 12px;
        font-size: 12px;
      }

      /* Lighting panel - Top right, below render dropdown */
      .lighting-panel {
        position: absolute;
        top: 60px;
        right: 16px;
        left: auto;
        bottom: auto;
        background: transparent;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }

      .lighting-header {
        display: block;
        font-size: 9px;
        letter-spacing: 2px;
        margin-bottom: 4px;
        opacity: 0.6;
      }

      .light-type-selector {
        flex-direction: row;
        gap: 10px;
        margin-bottom: 0;
      }

      .light-nav-btn {
        width: 28px;
        height: 28px;
      }

      .light-nav-btn svg {
        width: 12px;
        height: 12px;
      }

      .light-icon-container {
        width: 48px;
        height: 48px;
        border-radius: 10px;
      }

      .light-icon-container svg {
        width: 22px;
        height: 22px;
      }

      .light-type-name {
        font-size: 10px;
        letter-spacing: 2px;
        margin-bottom: 0;
        width: auto;
        text-align: center;
      }

      .light-type-mobile {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
      }

      /* Hide sliders container at top - they move to bottom */
      .sliders-container {
        display: none;
      }

      .shadow-container {
        display: none;
      }

      /* Animation panel - Center, above sliders */
      .animation-panel {
        top: auto;
        bottom: 195px;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        padding: 0;
        background: transparent;
        max-width: 100%;
      }

      .anim-btn {
        width: 32px;
        height: 32px;
      }

      .anim-btn svg {
        width: 12px;
        height: 12px;
      }

      .anim-select {
        min-width: 120px;
        padding: 8px 28px 8px 12px;
        font-size: 12px;
      }

      .fps-display {
        font-size: 12px;
        min-width: 55px;
      }

      /* Gallery - Bottom center */
      .model-gallery {
        bottom: 20px;
        gap: 8px;
      }

      .gallery-nav {
        width: 32px;
        height: 32px;
      }

      .gallery-nav svg {
        width: 14px;
        height: 14px;
      }

      .gallery-item {
        width: 48px;
        height: 48px;
      }

      .gallery-number {
        font-size: 14px;
      }
    }

    /* Mobile sliders panel - Created separately for bottom positioning */
    @media (max-width: 768px) {
      .mobile-sliders-panel {
        position: absolute;
        bottom: 85px;
        left: 16px;
        right: 16px;
        display: grid;
        grid-template-columns: 1fr auto 1fr auto 1fr;
        gap: 0;
        align-items: start;
        pointer-events: auto;
        color: #fff;
      }

      .mobile-slider-col {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 0 12px;
      }

      .mobile-slider-col:first-child {
        padding-left: 0;
      }

      .mobile-slider-col:last-child {
        padding-right: 0;
      }

      .mobile-divider {
        width: 1px;
        height: 70px;
        background: rgba(255,255,255,0.15);
        align-self: center;
      }

      .mobile-slider-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .mobile-slider-group .slider-label {
        font-size: 9px;
        letter-spacing: 1px;
        text-transform: uppercase;
        opacity: 0.6;
        margin-bottom: 0;
      }

      .mobile-slider-group .slider {
        width: 100%;
        height: 3px;
      }

      .mobile-shadow-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .mobile-shadow-row .shadow-label {
        font-size: 9px;
        letter-spacing: 1px;
        text-transform: uppercase;
        opacity: 0.6;
      }
    }

    /* Very small screens */
    @media (max-width: 480px) {
      .model-name {
        font-size: 18px;
      }

      .gallery-item {
        width: 40px;
        height: 40px;
      }

      .gallery-number {
        font-size: 12px;
      }

      .lighting-panel {
        top: 55px;
      }

      .light-icon-container {
        width: 42px;
        height: 42px;
      }

      .light-icon-container svg {
        width: 18px;
        height: 18px;
      }

      .animation-panel {
        bottom: 185px;
      }

      .anim-select {
        min-width: 100px;
        font-size: 11px;
      }

      .anim-btn {
        width: 28px;
        height: 28px;
      }

      .controls-hint {
        top: 140px;
      }

      .mobile-sliders-panel {
        bottom: 80px;
        grid-template-columns: 1fr auto 1fr auto auto;
      }

      .mobile-slider-col {
        padding: 0 8px;
      }
    }
  </style>
</head>
<body>
  <div id="canvas-container">
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      Cargando modelo...
    </div>
  </div>

  <div class="overlay">
    <!-- PANEL DE ILUMINACIÓN - ARRIBA IZQUIERDA (ABAJO EN MOBILE) -->
    <!-- Restructured for mobile horizontal layout -->
    <div class="lighting-panel">
      <div class="lighting-header">Light Type</div>
      
      <!-- Light type selector with icon -->
      <div class="light-type-mobile">
        <div class="light-type-selector">
          <button class="light-nav-btn" id="prev-light">
            <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </button>
          <div class="light-icon-container" id="light-icon">
            <svg viewBox="0 0 24 24" id="light-svg">
              <circle cx="12" cy="12" r="5"/>
              <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
          </div>
          <button class="light-nav-btn" id="next-light">
            <svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
          </button>
        </div>
        <div class="light-type-name" id="light-name">STUDIO</div>
      </div>

      <!-- Sliders container for grid layout on mobile -->
      <div class="sliders-container">
        <div class="slider-group">
          <span class="slider-label">Rotation</span>
          <div class="slider-row">
            <input type="range" class="slider" id="hdr-rotation" min="0" max="360" value="0">
          </div>
        </div>

        <div class="slider-group">
          <span class="slider-label">Exposure</span>
          <div class="slider-row">
            <input type="range" class="slider" id="hdr-exposure" min="0.1" max="3" value="1" step="0.1">
          </div>
        </div>

        <div class="slider-group">
          <span class="slider-label">Intensity</span>
          <div class="slider-row">
            <input type="range" class="slider" id="light-intensity" min="0" max="3" value="1" step="0.1">
          </div>
        </div>

        <div class="slider-group">
          <span class="slider-label">Ambient</span>
          <div class="slider-row">
            <input type="range" class="slider" id="ambient-intensity" min="0" max="2" value="0.3" step="0.1">
          </div>
        </div>
      </div>

      <!-- Shadow controls -->
      <div class="shadow-container">
        <div class="shadow-row">
          <span class="shadow-label">Shadows</span>
          <div class="toggle-switch active" id="shadow-toggle"></div>
        </div>
        
        <div id="shadow-settings">
          <div class="slider-group" style="margin-top: 8px;">
            <span class="slider-label">Softness</span>
            <div class="slider-row">
              <input type="range" class="slider" id="shadow-softness" min="0" max="1" value="0.5" step="0.1">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTROLES DE ANIMACIÓN - ARRIBA CENTRO -->
    <div class="animation-panel" id="animation-panel">
      <button class="anim-btn" id="play-pause-btn" disabled>
        <svg viewBox="0 0 24 24" id="play-icon"><path d="M8 5v14l11-7z"/></svg>
        <svg viewBox="0 0 24 24" id="pause-icon" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
      </button>
      <button class="anim-btn" id="stop-btn" disabled>
        <svg viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"/></svg>
      </button>
      <button class="anim-btn" id="loop-btn" disabled>
        <svg viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
      </button>
      <select class="anim-select" id="anim-select" disabled>
        <option value="">Sin animaciones</option>
      </select>
      <div class="fps-display">FPS <span id="fps-value">24</span></div>
    </div>

    <!-- DROPDOWN DE RENDER MODE - ARRIBA DERECHA -->
    <div class="render-dropdown-container">
      <button class="render-dropdown-btn" id="render-dropdown-btn">
        <span id="current-render-mode">Composite</span>
        <svg viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
      </button>
      <div class="render-dropdown-menu" id="render-dropdown-menu">
        <button class="render-option active" data-mode="composite">Composite</button>
        <button class="render-option" data-mode="wireframe">Wireframe</button>
        <button class="render-option" data-mode="normal">Normal</button>
        <button class="render-option" data-mode="uv">UV</button>
        <button class="render-option" data-mode="ao">AO</button>
      </div>
    </div>

    <!-- INFO DEL MODELO - ABAJO IZQUIERDA -->
    <div class="model-info">
      <div class="tech-specs">
        <div class="spec-row">
          <span class="spec-label">Polygon Count</span>
          <span class="spec-value" id="poly-count">--</span>
        </div>
        <div class="spec-row">
          <span class="spec-label">Concept</span>
          <span class="spec-value" id="concept-type">Original</span>
        </div>
        <div class="spec-row">
          <span class="spec-label">Time</span>
          <span class="spec-value" id="time-spent">--</span>
        </div>
      </div>
      <h1 class="model-name" id="model-name">Model Name</h1>
      <div class="software-icons">
        <div class="software-icon" id="icon-blender" title="Blender">
          <svg viewBox="0 0 24 24"><path d="M12.51 13.214c.046-.8.438-1.506 1.03-2.006a3.424 3.424 0 0 1 2.212-.79c.85 0 1.631.3 2.211.79.592.5.983 1.206 1.028 2.005.045.823-.285 1.586-.865 2.153a3.389 3.389 0 0 1-2.374.938 3.393 3.393 0 0 1-2.376-.938c-.58-.567-.91-1.33-.865-2.152M7.35 14.831c.006.314.106.922.256 1.398a7.372 7.372 0 0 0 1.477 2.564 7.463 7.463 0 0 0 2.476 1.79 7.545 7.545 0 0 0 3.008.637 7.59 7.59 0 0 0 3.074-.62 7.436 7.436 0 0 0 2.449-1.727 7.329 7.329 0 0 0 1.63-2.552c.299-.915.398-1.656.395-1.992-.002-.227-.012-.453-.038-.68-.004-.037-.01-.072-.013-.109a7.294 7.294 0 0 0-1.052-3.173 7.432 7.432 0 0 0-2.41-2.455 7.475 7.475 0 0 0-3.025-1.17 7.582 7.582 0 0 0-3.397.232 7.43 7.43 0 0 0-2.867 1.693 7.289 7.289 0 0 0-1.63 2.528 7.17 7.17 0 0 0-.457 1.93c-.043.51-.047.986-.028 1.257.012.163.03.324.054.483a.67.67 0 0 0 .024.12c.008.037.015.074.023.112l.022.132c.033.225.066.375.1.504zm7.218-8.771l-.002-.005v.003l.002.002zm-6.063 1.263l-.002-.002.002.002zm-.313-.26l-.002-.004.002.003zm-1.145-.906l-.003-.002.003.002zm-1.635-1.3l-.004-.003.004.003zm-1.578-1.25l-.003-.002.003.002zm-.4-.318l.002.003-.002-.003zM5.63 3.112l-.002-.003.002.003zm-.316-.24l-.002-.002.002.002zm-.197-.141l.003.003-.003-.003zm-.107-.071l.004.003-.004-.003zm-.11-.067l.005.003-.006-.003zm-.211-.117.009.005-.009-.005zm3.89 3.097l-.003-.003.003.003zM3.4 2.097l-.002-.002.002.002zm-.312-.208l.003.002-.003-.002zm-.107-.065l.005.003-.005-.003zm-.106-.06.008.005-.008-.006zm5.145 4.108l-.002-.002.002.002zm-4.58-4.07l.007.004-.008-.004zm-.068-.037l.01.006-.01-.006zm-.064-.031l.01.005-.01-.005zm-.062-.028l.01.005-.01-.005zm-.053-.023l.008.004-.008-.004zm-.063-.025l.011.005-.012-.005zM2.5 1.42l.017.008-.017-.008zm-.077-.03l.013.005-.014-.006zm-.051-.018l.018.007-.018-.007zm-.062-.021l.014.005-.014-.005zm-.05-.015l.016.005-.017-.005zm-.053-.014l.018.005-.018-.005zm-.053-.013l.018.005-.018-.006zm-.053-.011l.018.004-.018-.005zm-.034-.007l.017.004-.017-.004zm-.05-.01l.02.004-.02-.004zm-.051-.008l.01... <truncated>
        </div>
        <div class="software-icon" id="icon-substance" title="Substance Painter">
          <svg viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22.5C6.201 22.5 1.5 17.799 1.5 12S6.201 1.5 12 1.5 22.5 6.201 22.5 12 17.799 22.5 12 22.5zm0-18a7.5 7.5 0 1 0 0 15 7.5 7.5 0 0 0 0-15zm0 13.5a6 6 0 1 1 0-12 6 6 0 0 1 0 12z"/></svg>
        </div>
        <div class="software-icon" id="icon-zbrush" title="ZBrush">
          <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <div class="software-icon" id="icon-maya" title="Maya">
          <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
        </div>
      </div>
    </div>

    <!-- GALERÍA DE MODELOS - ABAJO CENTRO -->
    <div class="model-gallery">
      <button class="gallery-nav" id="gallery-prev">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      </button>
      <div class="gallery-items" id="gallery-items">
        <!-- Items generados dinámicamente -->
      </div>
      <button class="gallery-nav" id="gallery-next">
        <svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
      </button>
    </div>

    <!-- HINTS DE CONTROLES - ABAJO DERECHA -->
    <div class="controls-hint">
      Arrastra para rotar<br>
      Scroll para zoom
    </div>

    <!-- MOBILE SLIDERS PANEL - Solo visible en móvil -->
    <div class="mobile-sliders-panel">
      <!-- Columna 1: Rotation + Exposure -->
      <div class="mobile-slider-col">
        <div class="mobile-slider-group">
          <span class="slider-label">Rotation</span>
          <input type="range" class="slider" id="mobile-hdr-rotation" min="0" max="360" value="0">
        </div>
        <div class="mobile-slider-group">
          <span class="slider-label">Exposure</span>
          <input type="range" class="slider" id="mobile-hdr-exposure" min="0.1" max="3" value="1" step="0.1">
        </div>
      </div>
      
      <!-- Divider -->
      <div class="mobile-divider"></div>
      
      <!-- Columna 2: Intensity + Ambient -->
      <div class="mobile-slider-col">
        <div class="mobile-slider-group">
          <span class="slider-label">Intensity</span>
          <input type="range" class="slider" id="mobile-light-intensity" min="0" max="3" value="1" step="0.1">
        </div>
        <div class="mobile-slider-group">
          <span class="slider-label">Ambient</span>
          <input type="range" class="slider" id="mobile-ambient-intensity" min="0" max="2" value="0.3" step="0.1">
        </div>
      </div>
      
      <!-- Divider -->
      <div class="mobile-divider"></div>
      
      <!-- Columna 3: Shadows + Softness -->
      <div class="mobile-slider-col">
        <div class="mobile-shadow-row">
          <span class="shadow-label">Shadows</span>
          <div class="toggle-switch active" id="mobile-shadow-toggle"></div>
        </div>
        <div class="mobile-slider-group">
          <span class="slider-label">Softness</span>
          <input type="range" class="slider" id="mobile-shadow-softness" min="0" max="1" value="0.5" step="0.1">
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';
    import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
    import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
    import { SMAAPass } from 'three/addons/postprocessing/SMAAPass.js';

    // Configuration
    const CONFIG = {
      models: [
        {
          name: "RUBBER DUCK",
          url: "https://threejs.org/examples/models/gltf/Duck/glTF/Duck.gltf",
          software: ["blender", "substance"],
          concept: "Original",
          time: "~8 hrs"
        },
        {
          name: "SOLDIER",
          url: "https://threejs.org/examples/models/gltf/Soldier.glb",
          software: ["blender", "maya", "substance"],
          concept: "Fan Art",
          time: "~24 hrs"
        },
        {
          name: "ROBOT",
          url: "https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb",
          software: ["blender", "zbrush"],
          concept: "Original",
          time: "~16 hrs"
        },
        {
          name: "PARROT",
          url: "https://threejs.org/examples/models/gltf/Parrot.glb",
          software: ["blender"],
          concept: "Study",
          time: "~4 hrs"
        }
      ],
      lightPresets: [
        { 
          name: "STUDIO", 
          icon: "sun",
          hdr: null,
          intensity: 1.5,
          ambient: 0.3
        },
        { 
          name: "DAWN", 
          icon: "sunrise",
          hdr: null,
          intensity: 1.2,
          ambient: 0.4
        },
        { 
          name: "NIGHT", 
          icon: "moon",
          hdr: null,
          intensity: 0.8,
          ambient: 0.2
        },
        { 
          name: "OUTDOOR", 
          icon: "cloud",
          hdr: null,
          intensity: 2.0,
          ambient: 0.5
        }
      ]
    };

    // Light icons SVG paths
    const LIGHT_ICONS = {
      sun: '<circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>',
      sunrise: '<path d="M17 18a5 5 0 0 0-10 0"/><line x1="12" y1="2" x2="12" y2="9"/><line x1="4.22" y1="10.22" x2="5.64" y2="11.64"/><line x1="1" y1="18" x2="3" y2="18"/><line x1="21" y1="18" x2="23" y2="18"/><line x1="18.36" y1="11.64" x2="19.78" y2="10.22"/><line x1="23" y1="22" x2="1" y2="22"/><polyline points="8 6 12 2 16 6"/>',
      moon: '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>',
      cloud: '<path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>'
    };

    class ModelShowcase {
      constructor() {
        this.currentModel = 0;
        this.currentLight = 0;
        this.renderMode = 'composite';
        this.model = null;
        this.mixer = null;
        this.animations = [];
        this.currentAction = null;
        this.isPlaying = false;
        this.isLooping = true;
        this.clock = new THREE.Clock();
        this.shadowsEnabled = true;
        this.originalMaterials = new Map();
        
        this.init();
      }

      init() {
        this.setupScene();
        this.setupRenderer();
        this.setupCamera();
        this.setupControls();
        this.setupLights();
        this.setupPostProcessing();
        this.setupGrid();
        this.setupEventListeners();
        this.setupGallery();
        this.loadModel(0);
        this.updateLightUI();
        this.animate();
      }

      setupScene() {
        this.scene = new THREE.Scene();
        this.scene.background = new THREE.Color(0x0a0a0a);
      }

      setupRenderer() {
        this.renderer = new THREE.WebGLRenderer({ 
          antialias: true,
          alpha: true,
          powerPreference: "high-performance"
        });
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        this.renderer.shadowMap.enabled = true;
        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
        this.renderer.toneMappingExposure = 1;
        this.renderer.outputColorSpace = THREE.SRGBColorSpace;
        
        document.getElementById('canvas-container').appendChild(this.renderer.domElement);
      }

      setupCamera() {
        this.camera = new THREE.PerspectiveCamera(
          45,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        this.camera.position.set(0, 1, 4);
      }

      setupControls() {
        this.controls = new OrbitControls(this.camera, this.renderer.domElement);
        this.controls.enableDamping = true;
        this.controls.dampingFactor = 0.05;
        this.controls.minDistance = 1;
        this.controls.maxDistance = 20;
        this.controls.maxPolarAngle = Math.PI * 0.9;
        this.controls.target.set(0, 0.5, 0);
      }

      setupLights() {
        // Ambient light
        this.ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        this.scene.add(this.ambientLight);

        // Main directional light
        this.mainLight = new THREE.DirectionalLight(0xffffff, 1.5);
        this.mainLight.position.set(5, 10, 7);
        this.mainLight.castShadow = true;
        this.mainLight.shadow.mapSize.width = 2048;
        this.mainLight.shadow.mapSize.height = 2048;
        this.mainLight.shadow.camera.near = 0.5;
        this.mainLight.shadow.camera.far = 50;
        this.mainLight.shadow.camera.left = -10;
        this.mainLight.shadow.camera.right = 10;
        this.mainLight.shadow.camera.top = 10;
        this.mainLight.shadow.camera.bottom = -10;
        this.mainLight.shadow.radius = 4;
        this.scene.add(this.mainLight);

        // Fill light
        this.fillLight = new THREE.DirectionalLight(0x8888ff, 0.3);
        this.fillLight.position.set(-5, 3, -5);
        this.scene.add(this.fillLight);

        // Rim light
        this.rimLight = new THREE.DirectionalLight(0xff8888, 0.2);
        this.rimLight.position.set(0, 5, -10);
        this.scene.add(this.rimLight);

        // Floating spheres as accent lights
        this.createAccentSpheres();
      }

      createAccentSpheres() {
        const sphereGeometry = new THREE.IcosahedronGeometry(0.15, 2);
        const sphereMaterial = new THREE.MeshBasicMaterial({ color: 0xff1493 });
        
        this.accentSpheres = [];
        const positions = [
          new THREE.Vector3(-1.5, 1.2, 0.5),
          new THREE.Vector3(1.8, 0.8, -0.3),
          new THREE.Vector3(0.8, 1.8, 1)
        ];

        positions.forEach((pos, i) => {
          const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
          sphere.position.copy(pos);
          this.scene.add(sphere);
          this.accentSpheres.push({ mesh: sphere, baseY: pos.y, phase: i * 2 });
        });
      }

      setupPostProcessing() {
        this.composer = new EffectComposer(this.renderer);
        
        const renderPass = new RenderPass(this.scene, this.camera);
        this.composer.addPass(renderPass);

        this.bloomPass = new UnrealBloomPass(
          new THREE.Vector2(window.innerWidth, window.innerHeight),
          0.3,
          0.4,
          0.85
        );
        this.composer.addPass(this.bloomPass);

        const smaaPass = new SMAAPass(
          window.innerWidth * this.renderer.getPixelRatio(),
          window.innerHeight * this.renderer.getPixelRatio()
        );
        this.composer.addPass(smaaPass);
      }

      setupGrid() {
        // Ground plane for shadows
        const groundGeometry = new THREE.PlaneGeometry(50, 50);
        const groundMaterial = new THREE.ShadowMaterial({ 
          opacity: 0.3,
          transparent: true 
        });
        this.ground = new THREE.Mesh(groundGeometry, groundMaterial);
        this.ground.rotation.x = -Math.PI / 2;
        this.ground.position.y = 0;
        this.ground.receiveShadow = true;
        this.scene.add(this.ground);

        // Grid helper
        this.gridHelper = new THREE.GridHelper(20, 40, 0x333333, 0x222222);
        this.gridHelper.position.y = 0.001;
        this.scene.add(this.gridHelper);

        // Axis lines
        const axisLength = 10;
        
        // X axis (red)
        const xMaterial = new THREE.LineBasicMaterial({ color: 0xff3333, transparent: true, opacity: 0.5 });
        const xGeometry = new THREE.BufferGeometry().setFromPoints([
          new THREE.Vector3(-axisLength, 0, 0),
          new THREE.Vector3(axisLength, 0, 0)
        ]);
        this.scene.add(new THREE.Line(xGeometry, xMaterial));

        // Z axis (blue)
        const zMaterial = new THREE.LineBasicMaterial({ color: 0x3333ff, transparent: true, opacity: 0.5 });
        const zGeometry = new THREE.BufferGeometry().setFromPoints([
          new THREE.Vector3(0, 0, -axisLength),
          new THREE.Vector3(0, 0, axisLength)
        ]);
        this.scene.add(new THREE.Line(zGeometry, zMaterial));
      }

      setupGallery() {
        const container = document.getElementById('gallery-items');
        container.innerHTML = '';
        
        CONFIG.models.forEach((model, index) => {
          const item = document.createElement('div');
          item.className = `gallery-item${index === 0 ? ' active' : ''}`;
          item.innerHTML = `<span class="gallery-number">${String(index + 1).padStart(2, '0')}</span>`;
          item.addEventListener('click', () => this.loadModel(index));
          container.appendChild(item);
        });
      }

      async loadModel(index) {
        this.currentModel = index;
        const modelConfig = CONFIG.models[index];
        
        // Show loading
        document.getElementById('loading').style.display = 'block';
        
        // Clear previous model
        if (this.model) {
          this.scene.remove(this.model);
          this.model = null;
        }
        
        // Reset animation
        if (this.mixer) {
          this.mixer.stopAllAction();
          this.mixer = null;
        }
        this.animations = [];
        this.currentAction = null;
        this.isPlaying = false;
        
        // Update UI
        document.getElementById('model-name').textContent = modelConfig.name;
        document.getElementById('concept-type').textContent = modelConfig.concept;
        document.getElementById('time-spent').textContent = modelConfig.time;
        
        // Update software icons
        document.querySelectorAll('.software-icon').forEach(icon => {
          icon.classList.remove('visible');
        });
        modelConfig.software.forEach(sw => {
          const icon = document.getElementById(`icon-${sw}`);
          if (icon) icon.classList.add('visible');
        });
        
        // Update gallery
        document.querySelectorAll('.gallery-item').forEach((item, i) => {
          item.classList.toggle('active', i === index);
        });

        // Load model
        const loader = new GLTFLoader();
        
        try {
          const gltf = await loader.loadAsync(modelConfig.url);
          this.model = gltf.scene;
          
          // Calculate bounding box for centering and scaling
          const box = new THREE.Box3().setFromObject(this.model);
          const center = box.getCenter(new THREE.Vector3());
          const size = box.getSize(new THREE.Vector3());
          
          // Center and scale model
          const maxDim = Math.max(size.x, size.y, size.z);
          const scale = 2 / maxDim;
          this.model.scale.setScalar(scale);
          
          // Recompute after scaling
          box.setFromObject(this.model);
          box.getCenter(center);
          this.model.position.sub(center);
          this.model.position.y = -box.min.y * scale;
          
          // Enable shadows
          this.model.traverse((child) => {
            if (child.isMesh) {
              child.castShadow = true;
              child.receiveShadow = true;
              // Store original material
              this.originalMaterials.set(child.uuid, child.material.clone());
            }
          });
          
          this.scene.add(this.model);
          
          // Count polygons
          let triangles = 0;
          this.model.traverse((child) => {
            if (child.isMesh && child.geometry) {
              const geo = child.geometry;
              if (geo.index) {
                triangles += geo.index.count / 3;
              } else if (geo.attributes.position) {
                triangles += geo.attributes.position.count / 3;
              }
            }
          });
          document.getElementById('poly-count').textContent = 
            triangles > 1000 ? `${(triangles/1000).toFixed(1)}k tris` : `${triangles} tris`;
          
          // Setup animations
          if (gltf.animations && gltf.animations.length > 0) {
            this.animations = gltf.animations;
            this.mixer = new THREE.AnimationMixer(this.model);
            this.updateAnimationUI();
          } else {
            this.updateAnimationUI();
          }
          
          // Apply current render mode
          this.applyRenderMode();
          
          // Reset camera
          this.controls.target.set(0, 0.5, 0);
          this.camera.position.set(0, 1, 4);
          
          document.getElementById('loading').style.display = 'none';
          
        } catch (error) {
          console.error('Error loading model:', error);
          document.getElementById('loading').innerHTML = 
            '<div style="color: #ff4444;">Error loading model</div>';
        }
      }

      updateAnimationUI() {
        const select = document.getElementById('anim-select');
        const playBtn = document.getElementById('play-pause-btn');
        const stopBtn = document.getElementById('stop-btn');
        const loopBtn = document.getElementById('loop-btn');
        
        select.innerHTML = '';
        
        if (this.animations.length === 0) {
          select.innerHTML = '<option value="">Sin animaciones</option>';
          select.disabled = true;
          playBtn.disabled = true;
          stopBtn.disabled = true;
          loopBtn.disabled = true;
        } else {
          this.animations.forEach((anim, i) => {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = anim.name || `Animation ${i + 1}`;
            select.appendChild(option);
          });
          select.disabled = false;
          playBtn.disabled = false;
          stopBtn.disabled = false;
          loopBtn.disabled = false;
          
          // Auto-select first animation
          this.selectAnimation(0);
        }
      }

      selectAnimation(index) {
        if (!this.mixer || index < 0 || index >= this.animations.length) return;
        
        // Stop current animation
        if (this.currentAction) {
          this.currentAction.stop();
        }
        
        // Setup new animation
        const clip = this.animations[index];
        this.currentAction = this.mixer.clipAction(clip);
        this.currentAction.setLoop(this.isLooping ? THREE.LoopRepeat : THREE.LoopOnce);
        this.currentAction.clampWhenFinished = true;
        
        if (this.isPlaying) {
          this.currentAction.play();
        }
      }

      togglePlayPause() {
        if (!this.currentAction) return;
        
        this.isPlaying = !this.isPlaying;
        
        if (this.isPlaying) {
          this.currentAction.paused = false;
          this.currentAction.play();
        } else {
          this.currentAction.paused = true;
        }
        
        this.updatePlayPauseIcon();
      }

      stopAnimation() {
        if (!this.currentAction) return;
        
        this.currentAction.stop();
        this.currentAction.reset();
        this.isPlaying = false;
        this.updatePlayPauseIcon();
      }

      toggleLoop() {
        this.isLooping = !this.isLooping;
        
        if (this.currentAction) {
          this.currentAction.setLoop(this.isLooping ? THREE.LoopRepeat : THREE.LoopOnce);
        }
        
        document.getElementById('loop-btn').style.opacity = this.isLooping ? '1' : '0.5';
      }

      updatePlayPauseIcon() {
        document.getElementById('play-icon').style.display = this.isPlaying ? 'none' : 'block';
        document.getElementById('pause-icon').style.display = this.isPlaying ? 'block' : 'none';
      }

      updateLightUI() {
        const preset = CONFIG.lightPresets[this.currentLight];
        document.getElementById('light-name').textContent = preset.name;
        document.getElementById('light-svg').innerHTML = LIGHT_ICONS[preset.icon];
        
        // Apply preset values
        this.mainLight.intensity = preset.intensity;
        this.ambientLight.intensity = preset.ambient;
        
        // Update sliders
        document.getElementById('light-intensity').value = preset.intensity;
        document.getElementById('ambient-intensity').value = preset.ambient;
      }

      applyRenderMode() {
        if (!this.model) return;
        
        this.model.traverse((child) => {
          if (child.isMesh) {
            const original = this.originalMaterials.get(child.uuid);
            
            switch (this.renderMode) {
              case 'wireframe':
                child.material = new THREE.MeshBasicMaterial({
                  wireframe: true,
                  color: 0xffffff
                });
                break;
              case 'normal':
                child.material = new THREE.MeshNormalMaterial();
                break;
              case 'uv':
                child.material = new THREE.MeshBasicMaterial({
                  map: this.createUVTexture(),
                  side: THREE.DoubleSide
                });
                break;
              case 'ao':
                child.material = new THREE.MeshBasicMaterial({
                  color: 0x888888,
                  aoMapIntensity: 1
                });
                break;
              default:
                if (original) {
                  child.material = original.clone();
                }
            }
          }
        });
      }

      createUVTexture() {
        const canvas = document.createElement('canvas');
        canvas.width = 512;
        canvas.height = 512;
        const ctx = canvas.getContext('2d');
        
        // Create UV grid pattern
        const gridSize = 32;
        for (let y = 0; y < canvas.height; y += gridSize) {
          for (let x = 0; x < canvas.width; x += gridSize) {
            const r = Math.floor((x / canvas.width) * 255);
            const g = Math.floor((y / canvas.height) * 255);
            ctx.fillStyle = `rgb(${r}, ${g}, 128)`;
            ctx.fillRect(x, y, gridSize, gridSize);
          }
        }
        
        // Add grid lines
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 1;
        for (let i = 0; i <= canvas.width; i += gridSize) {
          ctx.beginPath();
          ctx.moveTo(i, 0);
          ctx.lineTo(i, canvas.height);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(0, i);
          ctx.lineTo(canvas.width, i);
          ctx.stroke();
        }
        
        const texture = new THREE.CanvasTexture(canvas);
        texture.wrapS = THREE.RepeatWrapping;
        texture.wrapT = THREE.RepeatWrapping;
        return texture;
      }

      setupEventListeners() {
        // Window resize
        window.addEventListener('resize', () => {
          this.camera.aspect = window.innerWidth / window.innerHeight;
          this.camera.updateProjectionMatrix();
          this.renderer.setSize(window.innerWidth, window.innerHeight);
          this.composer.setSize(window.innerWidth, window.innerHeight);
        });

        // Light navigation
        document.getElementById('prev-light').addEventListener('click', () => {
          this.currentLight = (this.currentLight - 1 + CONFIG.lightPresets.length) % CONFIG.lightPresets.length;
          this.updateLightUI();
        });
        
        document.getElementById('next-light').addEventListener('click', () => {
          this.currentLight = (this.currentLight + 1) % CONFIG.lightPresets.length;
          this.updateLightUI();
        });

        // Light sliders
        document.getElementById('hdr-rotation').addEventListener('input', (e) => {
          const rotation = parseFloat(e.target.value) * Math.PI / 180;
          this.mainLight.position.x = 5 * Math.cos(rotation);
          this.mainLight.position.z = 7 * Math.sin(rotation);
          // Sync mobile slider
          const mobileSlider = document.getElementById('mobile-hdr-rotation');
          if (mobileSlider) mobileSlider.value = e.target.value;
        });

        document.getElementById('hdr-exposure').addEventListener('input', (e) => {
          this.renderer.toneMappingExposure = parseFloat(e.target.value);
          // Sync mobile slider
          const mobileSlider = document.getElementById('mobile-hdr-exposure');
          if (mobileSlider) mobileSlider.value = e.target.value;
        });

        document.getElementById('light-intensity').addEventListener('input', (e) => {
          this.mainLight.intensity = parseFloat(e.target.value);
          // Sync mobile slider
          const mobileSlider = document.getElementById('mobile-light-intensity');
          if (mobileSlider) mobileSlider.value = e.target.value;
        });

        document.getElementById('ambient-intensity').addEventListener('input', (e) => {
          this.ambientLight.intensity = parseFloat(e.target.value);
          // Sync mobile slider
          const mobileSlider = document.getElementById('mobile-ambient-intensity');
          if (mobileSlider) mobileSlider.value = e.target.value;
        });

        // Shadow controls
        document.getElementById('shadow-toggle').addEventListener('click', (e) => {
          this.shadowsEnabled = !this.shadowsEnabled;
          e.target.classList.toggle('active', this.shadowsEnabled);
          this.mainLight.castShadow = this.shadowsEnabled;
          document.getElementById('shadow-settings').style.display = 
            this.shadowsEnabled ? 'block' : 'none';
          // Sync mobile toggle
          const mobileToggle = document.getElementById('mobile-shadow-toggle');
          if (mobileToggle) mobileToggle.classList.toggle('active', this.shadowsEnabled);
        });

        document.getElementById('shadow-softness').addEventListener('input', (e) => {
          this.mainLight.shadow.radius = parseFloat(e.target.value) * 10;
          // Sync mobile slider
          const mobileSlider = document.getElementById('mobile-shadow-softness');
          if (mobileSlider) mobileSlider.value = e.target.value;
        });

        // Mobile sliders sync
        const mobileRotation = document.getElementById('mobile-hdr-rotation');
        const mobileExposure = document.getElementById('mobile-hdr-exposure');
        const mobileIntensity = document.getElementById('mobile-light-intensity');
        const mobileAmbient = document.getElementById('mobile-ambient-intensity');
        const mobileShadowToggle = document.getElementById('mobile-shadow-toggle');
        const mobileSoftness = document.getElementById('mobile-shadow-softness');

        if (mobileRotation) {
          mobileRotation.addEventListener('input', (e) => {
            const rotation = parseFloat(e.target.value) * Math.PI / 180;
            this.mainLight.position.x = 5 * Math.cos(rotation);
            this.mainLight.position.z = 7 * Math.sin(rotation);
            document.getElementById('hdr-rotation').value = e.target.value;
          });
        }

        if (mobileExposure) {
          mobileExposure.addEventListener('input', (e) => {
            this.renderer.toneMappingExposure = parseFloat(e.target.value);
            document.getElementById('hdr-exposure').value = e.target.value;
          });
        }

        if (mobileIntensity) {
          mobileIntensity.addEventListener('input', (e) => {
            this.mainLight.intensity = parseFloat(e.target.value);
            document.getElementById('light-intensity').value = e.target.value;
          });
        }

        if (mobileAmbient) {
          mobileAmbient.addEventListener('input', (e) => {
            this.ambientLight.intensity = parseFloat(e.target.value);
            document.getElementById('ambient-intensity').value = e.target.value;
          });
        }

        if (mobileShadowToggle) {
          mobileShadowToggle.addEventListener('click', (e) => {
            this.shadowsEnabled = !this.shadowsEnabled;
            e.target.classList.toggle('active', this.shadowsEnabled);
            document.getElementById('shadow-toggle').classList.toggle('active', this.shadowsEnabled);
            this.mainLight.castShadow = this.shadowsEnabled;
            document.getElementById('shadow-settings').style.display = 
              this.shadowsEnabled ? 'block' : 'none';
          });
        }

        if (mobileSoftness) {
          mobileSoftness.addEventListener('input', (e) => {
            this.mainLight.shadow.radius = parseFloat(e.target.value) * 10;
            document.getElementById('shadow-softness').value = e.target.value;
          });
        }

        // Render mode dropdown
        const dropdownBtn = document.getElementById('render-dropdown-btn');
        const dropdownMenu = document.getElementById('render-dropdown-menu');
        
        dropdownBtn.addEventListener('click', () => {
          dropdownBtn.classList.toggle('open');
          dropdownMenu.classList.toggle('open');
        });

        document.querySelectorAll('.render-option').forEach(option => {
          option.addEventListener('click', () => {
            const mode = option.dataset.mode;
            this.renderMode = mode;
            document.getElementById('current-render-mode').textContent = 
              option.textContent;
            document.querySelectorAll('.render-option').forEach(o => 
              o.classList.remove('active'));
            option.classList.add('active');
            dropdownBtn.classList.remove('open');
            dropdownMenu.classList.remove('open');
            this.applyRenderMode();
          });
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
          if (!e.target.closest('.render-dropdown-container')) {
            dropdownBtn.classList.remove('open');
            dropdownMenu.classList.remove('open');
          }
        });

        // Animation controls
        document.getElementById('play-pause-btn').addEventListener('click', () => {
          this.togglePlayPause();
        });

        document.getElementById('stop-btn').addEventListener('click', () => {
          this.stopAnimation();
        });

        document.getElementById('loop-btn').addEventListener('click', () => {
          this.toggleLoop();
        });

        document.getElementById('anim-select').addEventListener('change', (e) => {
          this.selectAnimation(parseInt(e.target.value));
        });

        // Gallery navigation
        document.getElementById('gallery-prev').addEventListener('click', () => {
          const newIndex = (this.currentModel - 1 + CONFIG.models.length) % CONFIG.models.length;
          this.loadModel(newIndex);
        });

        document.getElementById('gallery-next').addEventListener('click', () => {
          const newIndex = (this.currentModel + 1) % CONFIG.models.length;
          this.loadModel(newIndex);
        });
      }

      animate() {
        requestAnimationFrame(() => this.animate());
        
        const delta = this.clock.getDelta();
        const time = this.clock.getElapsedTime();
        
        // Update controls
        this.controls.update();
        
        // Update mixer
        if (this.mixer) {
          this.mixer.update(delta);
        }
        
        // Animate accent spheres
        this.accentSpheres.forEach((sphere) => {
          sphere.mesh.position.y = sphere.baseY + Math.sin(time * 0.8 + sphere.phase) * 0.1;
          sphere.mesh.rotation.y = time * 0.5;
        });
        
        // Calculate FPS
        const fps = Math.round(1 / delta);
        document.getElementById('fps-value').textContent = Math.min(fps, 120);
        
        // Render
        this.composer.render();
      }
    }

    // Initialize
    new ModelShowcase();
  </script>
</body>
</html>
